GAMS 51.1.0  2d039df5 Sep 13, 2025          WEX-WEI x86 64bit/MS Windows - 12/09/25 17:34:11 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


       
      The purpose of this model is to optimize household water usage based on different conservation actions.
       
      Conservation efforts are focused on different end uses, and what short-term and long-term actions can be taken to
      save water with each end use.
       
      The end uses are: shower, toilet, faucet, laundry, dishwasher, and outdoor use.
      Faucet includes handwashing, culinary, and handwashing dishes.
       
      The objective function is to minimize the cost of water used in a year. Assume $6.64 per 1000 gal of water.
       
      Dimensions: End uses, long-term actions, short-term actions.
       
      Decision Variables:
          X: volume of water for each end use
          Y: Action for each long-term end use
          Z: Action for each short-term end use
       
      State Variables:
          TotalX: Total volume of water from all end uses
          Cost: cost of water used
       
      Constraints:
          Water Volume per end use >= Minimum Volume
          For each end use (i)
              X >= Current Volume - (water saved)*Y - (water saved)*Z
              Y <= (willingness to do action i) [0,1]
              Z <= (willingness to do action i) [???] how to represent preference without doing every action to minimize cost???
       
      A Monte Carlo simulation will be used but for now I'm starting with a single model with made up input survey values.
       
      ** Just the linear program
       
      * Step 1. Define the Sets
      sets X end uses /Shower, Toilet, Faucets, Laundry, Dishwasher, Outdoor/
          Y short term actions /ShortShowers, LessShowers, LessToilet, LessFaucet, LessLaundry, LessDishLoads, ShortIrrigation, LessIrrigation/
          Z long term actions /LowFlowShower, LowFLowToilet, AeratorFaucet, HELaundry, HEDishwasher, ReduceYard/
          Data input data columns /RateStd, RateEff, Duration, Frequency, InvestCost/
      * 1a. Define subsets for to assign short term actions to the data they change
          YDuration(Y) actions that reduce duration /ShortShowers, ShortIrrigation/
          YFrequency(Y) actions that reduce frequency /LessShowers, LessToilet, LessFaucet, LessLaundry, LessDishLoads, LessIrrigation/;
       
      * 1b. Map actions to end uses
      Set MapYX(Y, X)
              /ShortShowers . Shower,
              LessShowers .Shower,
              LessToilet .Toilet,
              LessFaucet .Faucets,
              LessLaundry .Laundry,
              LessDishLoads .Dishwasher,
              ShortIrrigation .Outdoor,
              LessIrrigation .Outdoor/;
      Set MapZX(Z, X)
              /LowFlowShower .Shower
              LowFlowToilet .Toilet
              AeratorFaucet .Faucets
              HELaundry .Laundry
              HEDishwasher .Dishwasher
              ReduceYard .Outdoor/;
       
      * Step 2. Define the input data
      * 2a. Define the parameter to match the excel data
      Parameter InputData(X,Data) the input data from excel (and the survey)
                MaxReduction(X) the max duration and frequency can be reduced by short term actions
                PrefScoreY(Y) User preference for short term actions (1-10)
                PrefScoreZ(Z) User Preference for long term actions (1-10);
       
      * 2b. Load the input data
      $call gdxxrw.exe "Household_Input_Data.xlsx" output="Household_Input_Data.gdx" par=InputData rng=Sheet2!A3:F9 rDim=1 cDim=1 par=MaxReduction rng=Sheet2!I4:J11 rDim=1 cDim=0 par=PrefScoreY rng=Sheet2!L4:M11 rDim=1 cDim=0 par=PrefScoreZ rng=Sheet2!O4:P9 rDim=1 cDim=0
      $gdxIn Household_Input_Data.gdx
      $load InputData MaxReduction PrefScoreY PrefScoreZ
      $gdxIn
       
      * 2c. Put the input data into parameters
      Parameters RateStd(X)       The standard flow rate (gallons per minute or gallons per load)
                  RateEff(X)      The efficient flow rate for new appliances (GPM or GPL)
                  Duration(X)     The duration for each end use X
                  Frequency(X)    The frequency of use for each end use X
                  InvestCost(X)   The investment cost for buying a new appliance ($);
                  
       RateStd(X)     =InputData(X, 'RateStd');
       RateEff(x)     =InputData(X, 'RateEff');
       Duration(X)    =InputData(X, 'Duration');
       Frequency(X)   =InputData(X, 'Frequency');
       InvestCost(X)  =InputData(X, 'InvestCost');
       
      * 2d. Define the rest of the parameters using the input data 
      Parameters CurrentUse(X)    The volume of current water used by the household
                  DiscomfortCostY(Y)  The virtual cost for each short term action ($)
                  DiscomfortCostZ(Z)  The virtual cost for each long term action ($);
       
      Scalars WaterPrice Cost per gallon of water ($) /0.00664/
              PenaltyWeight Cost penalty per discomfort point ($) /10/
              MaxScore Maximum preference score /10/;
       
      CurrentUse(X)   = RateStd(X) * Duration(X) * Frequency(X);
      DiscomfortCostY(Y) = (MaxScore - PrefScoreY(Y)) * PenaltyWeight;            
      DiscomfortCostZ(Z) = (MaxScore - PrefScoreZ(Z)) * PenaltyWeight;
       
       
              
      * Step 3. Define the Variables
      Variables   TotalCost            Objective function value ($)
                  DoZAction(Z)        Binary variable to represent if a long term action is taken 1:do 0:don't
                  DoYAction(Y)        Variable to represent if a short term action is taken
                  TotalInvestCost     Total cost of implementing long term actions ($)
                  TotalWaterYear      Total water used per year (gallons)
                  WaterEndUse(X)      Total water used per end use (gallons);
       
      Binary Variable DoZAction(Z);
       
      Positive Variables DoYAction(Y), WaterEndUse(X);
       
      * Step 4. Define the equations using the variables
      Equations   TotalBenefit        Objective function ($)
                  TotalInvest         The total cost of long term actions ($)
                  TotalWaterUsed      The total water used in a year after conservation actions (gallons)
                  WaterUsed(X)        The water used for each end use after actions are taken
                  LimitDuration(X)    Constraint to make sure the duration doesn't exceed the max reduction
                  LimitFrequency(X)   Constraint to make sure the frequency doesn't exceed the max reduction;
       
      WaterUsed(X).. WaterEndUse(X) =e= (RateStd(X) * (1 - sum(Z$MapZX(Z,X), DoZAction(Z))) + RateEff(X) * sum(Z$MapZX(Z,X), DoZAction(Z))) *
                      (Duration(X) - sum(Y$(MapYX(Y,X) and YDuration(Y)), DoYAction(Y))) * (Frequency(X) - sum(Y$(MapYX(Y,X) and YFrequency(Y)), DoYAction(Y)));
      TotalInvest..   TotalInvestCost =e= sum((Z,X)$MapZX(Z,X), InvestCost(X) * DoZAction(Z));
      TotalWaterUsed.. TotalWaterYear =e= sum(X,WaterEndUse(X)) * 52;
       
      LimitDuration(X).. MaxReduction(X) =l= sum(Y$(MapYX(Y,X) and YDuration(Y)), DoYAction(Y));
      LimitFrequency(X).. MaxReduction(X) =L= sum(Y$(MapYX(Y,X) and YFrequency(Y)), DoYAction(Y));
      TotalBenefit.. TotalCost =e= TotalInvestCost + (TotalWaterYear * WaterPrice) +sum(Y, DiscomfortCostY(Y) * DoYAction(Y)) +sum(Z, DiscomfortCostZ(Z) * DoZAction(Z));
       
       
       
      * Step 5. Define the model
      Model WaterConservation /all/;
      Solve WaterConservation using MINLP minimizing TotalCost;
       
      * Step 6. Display Results
      Display TotalCost.l;
      Display RateStd, Duration, Frequency;
 144  *********************************************************
 145  ** Monte Carlo Simulation
 146  *********************************************************
 147   
 148  * Step 0. Define Monte Carlo Settings
 149  Set Sim "Simulation runs" /s1*s100/;
 150  Parameter MC_Results(Sim, *) "Storage for Monte Carlo Results";
 151   
 152  * Step 1. Define the Sets
 153  sets X end uses /Shower, Toilet, Faucets, Laundry, Dishwasher, Outdoor/
 154      Y short term actions /ShortShowers, LessShowers, LessToilet, LessFaucet, LessLaundry, LessDishLoads, ShortIrrigation, LessIrrigation/
 155      Z long term actions /LowFlowShower, LowFLowToilet, AeratorFaucet, HELaundry, HEDishwasher, ReduceYard/
 156      Data input data columns /RateStd, RateEff, Duration, Frequency, InvestCost/
 157  * 1a. Define subsets for to assign short term actions to the data they change
 158      YDuration(Y) actions that reduce duration /ShortShowers, ShortIrrigation/
 159      YFrequency(Y) actions that reduce frequency /LessShowers, LessToilet, LessFaucet, LessLaundry, LessDishLoads, LessIrrigation/;
 160   
 161  * 1b. Map actions to end uses
 162  Set MapYX(Y, X)
 163          /ShortShowers . Shower,
 164          LessShowers .Shower,
 165          LessToilet .Toilet,
 166          LessFaucet .Faucets,
 167          LessLaundry .Laundry,
 168          LessDishLoads .Dishwasher,
 169          ShortIrrigation .Outdoor,
 170          LessIrrigation .Outdoor/;
 171  Set MapZX(Z, X)
 172          /LowFlowShower .Shower
 173          LowFlowToilet .Toilet
 174          AeratorFaucet .Faucets
 175          HELaundry .Laundry
 176          HEDishwasher .Dishwasher
 177          ReduceYard .Outdoor/;
 178   
 179  * Step 2. Define Parameters
 180  Parameters RateStd(X)           The standard flow rate (gallons per minute or gallons per load)
 181              RateEff(X)          The efficient flow rate for new appliances (GPM or GPL)
 182              Duration(X)         The duration for each end use X (minutes)
 183              Frequency(X)        The frequency of use for each end use X
 184              InvestCost(X)       The investment cost for buying a new appliance ($)
 185              MaxReduction(X)     The max duration and frequency can be reduced by short term actions
 186              PrefScoreY(Y)       User preference for short term actions (1-10)
 187              PrefScoreZ(Z)       User Preference for long term actions (1-10)
 188              DiscomfortCostY(Y)  The virtual cost for each short term action ($)
 189              DiscomfortCostZ(Z)  The virtual cost for each long term action ($);
 190   
 191  Parameter RateEff(X)
 192      /Shower      1.5,
 193      Toilet      1.6,
 194      Faucets     1.5,
 195      Laundry     13,
 196      Dishwasher  4,
 197      Outdoor     5  /;
 198   
 199  Scalars WaterPrice Cost per gallon of water ($) /0.00664/
 200          PenaltyWeight Cost penalty per discomfort point ($) /10/
 201          MaxScore Maximum preference score /10/;
 202   
 203  * Step 3. Define the Variables
 204  Variables   TotalCost            Objective function value ($)
 205              DoZAction(Z)        Binary variable to represent if a long term action is taken 1:do 0:don't
 206              DoYAction(Y)        Variable to represent if a short term action is taken
 207              TotalInvestCost     Total cost of implementing long term actions ($)
 208              TotalWaterYear      Total water used per year (gallons)
 209              WaterEndUse(X)      Total water used per end use (gallons);
 210   
 211  Binary Variable DoZAction(Z);
 212   
 213  Positive Variables DoYAction(Y), WaterEndUse(X);
 214   
 215  * Step 4. Define the equations using the variables
 216  Equations   TotalBenefit        Objective function ($)
 217              TotalInvest         The total cost of long term actions ($)
 218              TotalWaterUsed      The total water used in a year after conservation actions (gallons)
 219              WaterUsed(X)        The water used for each end use after actions are taken
 220              LimitDuration(X)    Constraint to make sure the duration doesn't exceed the max reduction
 221              LimitFrequency(X)   Constraint to make sure the frequency doesn't exceed the max reduction;
 222   
 223  WaterUsed(X).. WaterEndUse(X) =e= (RateStd(X) * (1 - sum(Z$MapZX(Z,X), DoZAction(Z))) + RateEff(X) * sum(Z$MapZX(Z,X), DoZAction(Z))) *
 224                  (Duration(X) - sum(Y$(MapYX(Y,X) and YDuration(Y)), DoYAction(Y))) * (Frequency(X) - sum(Y$(MapYX(Y,X) and YFrequency(Y)), DoYAction(Y)));
 225  TotalInvest..   TotalInvestCost =e= sum((Z,X)$MapZX(Z,X), InvestCost(X) * DoZAction(Z));
 226  TotalWaterUsed.. TotalWaterYear =e= sum(X,WaterEndUse(X)) * 52;
 227   
 228  LimitDuration(X).. MaxReduction(X) =l= sum(Y$(MapYX(Y,X) and YDuration(Y)), DoYAction(Y));
 229  LimitFrequency(X).. MaxReduction(X) =L= sum(Y$(MapYX(Y,X) and YFrequency(Y)), DoYAction(Y));
 230  TotalBenefit.. TotalCost =e= TotalInvestCost + (TotalWaterYear * WaterPrice) +sum(Y, DiscomfortCostY(Y) * DoYAction(Y)) +sum(Z, DiscomfortCostZ(Z) * DoZAction(Z));
 231   
 232  * Step 5. Define the Model
 233  Model WaterConservationMC /all/;
 234   
 235  * Step 6. Define the Monte Carlo loop
 236  Loop(Sim,
 237   
 238  * --- A. GENERATE RANDOM DATA ---
 239  * Generate base data roughly based on realistic ranges
 240      RateStd(X)   = max(RateEff(X) + 0.1, Uniform(1.5, 6.0));
 241      Duration(X)  = Uniform(5, 30);
 242      Frequency(X) = Uniform(1, 10);
 243      InvestCost(X)= Uniform(50, 500);
 244   
 245  * Generate Preferences (1-10)
 246      PrefScoreY(Y) = UniformInt(1, 10);
 247      PrefScoreZ(Z) = UniformInt(1, 10);
 248   
 249  * Calculate MaxReduction (Here defined as 30% of the base Duration/Frequency)
 250      MaxReduction(X) = 0;
 251   
 252  * If X has duration actions, max reduction is 30% of Duration
 253      MaxReduction(X)$(sum(Y$(MapYX(Y,X) and YDuration(Y)),1)) = Duration(X) * 0.30;
 254   
 255  * If X has frequency actions, max reduction is 30% of Frequency
 256      MaxReduction(X)$(sum(Y$(MapYX(Y,X) and YFrequency(Y)),1)) = Frequency(X) * 0.30;
 257   
 258  * Recalculate Discomfort Costs based on new random scores
 259      DiscomfortCostY(Y) = (MaxScore - PrefScoreY(Y)) * PenaltyWeight;
 260      DiscomfortCostZ(Z) = (MaxScore - PrefScoreZ(Z)) * PenaltyWeight;
 261   
 262  * --- B. SOLVE ---
 263      Solve WaterConservationMC using MINLP minimizing TotalCost;
 264   
 265  * --- C. STORE RESULTS ---
 266      MC_Results(Sim, 'ObjValue')   = TotalCost.l;
 267      MC_Results(Sim, 'WaterYear')  = TotalWaterYear.l;
 268      MC_Results(Sim, 'InvestCost') = TotalInvestCost.l;
 269  );
 270   
 271  * Step 7. Display the results
 272  Display MC_Results;


COMPILATION TIME     =        0.016 SECONDS      3 MB  51.1.0 2d039df5 WEX-WEI
GAMS 51.1.0  2d039df5 Sep 13, 2025          WEX-WEI x86 64bit/MS Windows - 12/09/25 17:34:11 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Equation Listing    SOLVE WaterConservationMC Using MINLP From line 263


---- TotalBenefit  =E=  Objective function ($)

TotalBenefit..  TotalCost - 80*DoZAction(LowFlowShower) - 10*DoZAction(LowFLowToilet) - 70*DoZAction(AeratorFaucet) - 70*DoZAction(HELaundry) - 40*DoZAction(HEDishwasher) - 20*DoZAction(ReduceYard) - 40*DoYAction(ShortShowers) - 10*DoYAction(LessShowers) - 70*DoYAction(LessToilet) - 30*DoYAction(LessFaucet) - 20*DoYAction(LessLaundry) - 60*DoYAction(LessDishLoads) - 80*DoYAction(ShortIrrigation) - 40*DoYAction(LessIrrigation) - TotalInvestCost - 0.00664*TotalWaterYear =E= 0 ; (LHS = 0)
     

---- TotalInvest  =E=  The total cost of long term actions ($)

TotalInvest..  - 351.01787405*DoZAction(LowFlowShower) - 245.91037145*DoZAction(LowFLowToilet) - 211.8651197*DoZAction(AeratorFaucet) - 208.1486156*DoZAction(HELaundry) - 109.1712155*DoZAction(HEDishwasher) - 117.5458046*DoZAction(ReduceYard) + TotalInvestCost =E= 0 ; (LHS = 0)
     

---- TotalWaterUsed  =E=  The total water used in a year after conservation actions (gallons)

TotalWaterUsed..  TotalWaterYear - 52*WaterEndUse(Shower) - 52*WaterEndUse(Toilet) - 52*WaterEndUse(Faucets) - 52*WaterEndUse(Laundry) - 52*WaterEndUse(Dishwasher) - 52*WaterEndUse(Outdoor) =E= 0 ; (LHS = 0)
     

---- WaterUsed  =E=  The water used for each end use after actions are taken

WaterUsed(Shower)..  (105.387998931209)*DoZAction(LowFlowShower) + (22.5472405240871)*DoYAction(ShortShowers) + (31.2422227666629)*DoYAction(LessShowers) + WaterEndUse(Shower) =E= 0 ; (LHS = -309.929015529201, INFES = 309.929015529201 ****)
     
WaterUsed(Toilet)..  (766.88614296907)*DoZAction(LowFLowToilet) + (139.81587006818)*DoYAction(LessToilet) + WaterEndUse(Toilet) =E= 0 ; (LHS = -1098.98828034951, INFES = 1098.98828034951 ****)
     
WaterUsed(Faucets)..  (35.9925787564956)*DoZAction(AeratorFaucet) + (26.5557057812187)*DoYAction(LessFaucet) + WaterEndUse(Faucets) =E= 0 ; (LHS = -57.791385918503, INFES = 57.791385918503 ****)
     
REMAINING 3 ENTRIES SKIPPED

**** Exec Error at line 228: Equation infeasible due to rhs value

**** INFEASIBLE EQUATIONS ...

---- LimitDuration  =L=  Constraint to make sure the duration doesn't exceed the max reduction

LimitDuration(Toilet)..  0 =L= -2.3580762609 ; (LHS = 0, INFES = 2.3580762609 ****)
     
LimitDuration(Faucets)..  0 =L= -0.6528697041 ; (LHS = 0, INFES = 0.6528697041 ****)
     
LimitDuration(Laundry)..  0 =L= -2.0272406493 ; (LHS = 0, INFES = 2.0272406493 ****)
     
LimitDuration(Dishwasher)..  0 =L= -0.7306982328 ; (LHS = 0, INFES = 0.7306982328 ****)
     
REMAINING 2 ENTRIES SKIPPED


---- LimitFrequency  =L=  Constraint to make sure the frequency doesn't exceed the max reduction

LimitFrequency(Shower)..  - DoYAction(LessShowers) =L= -2.9760592053 ; (LHS = 0, INFES = 2.9760592053 ****)
     
LimitFrequency(Toilet)..  - DoYAction(LessToilet) =L= -2.3580762609 ; (LHS = 0, INFES = 2.3580762609 ****)
     
LimitFrequency(Faucets)..  - DoYAction(LessFaucet) =L= -0.6528697041 ; (LHS = 0, INFES = 0.6528697041 ****)
     
REMAINING 3 ENTRIES SKIPPED

GAMS 51.1.0  2d039df5 Sep 13, 2025          WEX-WEI x86 64bit/MS Windows - 12/09/25 17:34:11 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Column Listing      SOLVE WaterConservationMC Using MINLP From line 263


---- TotalCost  Objective function value ($)

TotalCost
                (.LO, .L, .UP, .M = -INF, 0, +INF, 0)
        1       TotalBenefit


---- DoZAction  Binary variable to represent if a long term action is taken 1:do 0:don't

DoZAction(LowFlowShower)
                (.LO, .L, .UP, .M = 0, 0, 1, 0)
      -80       TotalBenefit
     -351.0179  TotalInvest
     (105.388)  WaterUsed(Shower)

DoZAction(LowFLowToilet)
                (.LO, .L, .UP, .M = 0, 0, 1, 0)
      -10       TotalBenefit
     -245.9104  TotalInvest
     (766.8861) WaterUsed(Toilet)

DoZAction(AeratorFaucet)
                (.LO, .L, .UP, .M = 0, 0, 1, 0)
      -70       TotalBenefit
     -211.8651  TotalInvest
      (35.9926) WaterUsed(Faucets)

REMAINING 3 ENTRIES SKIPPED

---- DoYAction  Variable to represent if a short term action is taken

DoYAction(ShortShowers)
                (.LO, .L, .UP, .M = 0, 0, +INF, 0)
      -40       TotalBenefit
      (22.5472) WaterUsed(Shower)
       -1       LimitDuration(Shower)

DoYAction(LessShowers)
                (.LO, .L, .UP, .M = 0, 0, +INF, 0)
      -10       TotalBenefit
      (31.2422) WaterUsed(Shower)
       -1       LimitFrequency(Shower)

DoYAction(LessToilet)
                (.LO, .L, .UP, .M = 0, 0, +INF, 0)
      -70       TotalBenefit
     (139.8159) WaterUsed(Toilet)
       -1       LimitFrequency(Toilet)

REMAINING 5 ENTRIES SKIPPED

---- TotalInvestCost  Total cost of implementing long term actions ($)

TotalInvestCost
                (.LO, .L, .UP, .M = -INF, 0, +INF, 0)
       -1       TotalBenefit
        1       TotalInvest


---- TotalWaterYear  Total water used per year (gallons)

TotalWaterYear
                (.LO, .L, .UP, .M = -INF, 0, +INF, 0)
       -0.0066  TotalBenefit
        1       TotalWaterUsed


---- WaterEndUse  Total water used per end use (gallons)

WaterEndUse(Shower)
                (.LO, .L, .UP, .M = 0, 0, +INF, 0)
      -52       TotalWaterUsed
        1       WaterUsed(Shower)

WaterEndUse(Toilet)
                (.LO, .L, .UP, .M = 0, 0, +INF, 0)
      -52       TotalWaterUsed
        1       WaterUsed(Toilet)

WaterEndUse(Faucets)
                (.LO, .L, .UP, .M = 0, 0, +INF, 0)
      -52       TotalWaterUsed
        1       WaterUsed(Faucets)

REMAINING 3 ENTRIES SKIPPED
GAMS 51.1.0  2d039df5 Sep 13, 2025          WEX-WEI x86 64bit/MS Windows - 12/09/25 17:34:11 Page 4
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Model Statistics    SOLVE WaterConservationMC Using MINLP From line 263


LOOPS                                  Sim   s1


MODEL STATISTICS

BLOCKS OF EQUATIONS           6     SINGLE EQUATIONS           21
BLOCKS OF VARIABLES           6     SINGLE VARIABLES           23
NON ZERO ELEMENTS            59     NON LINEAR N-Z              0
CODE LENGTH                  60     CONSTANT POOL              36


GENERATION TIME      =        0.000 SECONDS      4 MB  51.1.0 2d039df5 WEX-WEI

**** SOLVE from line 263 ABORTED, EXECERROR = 1


EXECUTION TIME       =        0.000 SECONDS      4 MB  51.1.0 2d039df5 WEX-WEI


USER: Course License                                 G250902+0003Ac-GEN
      Utah State University                                     DCE4709
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\A02312721\Documents\GAMS\Studio\workspace\Household Conservation.gms
Output     C:\Users\A02312721\Documents\GAMS\Studio\workspace\Household Conservation\Household Conservation.lst

**** USER ERROR(S) ENCOUNTERED
